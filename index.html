<!DOCTYPE html>
<html>
<head>
<title>Sun Timing Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#ffb347,#ffcc33,#ff8c00);
color:#333;
}

/* header */
.header{
text-align:center;
padding:20px;
color:white;
}

.mantra{
font-size:28px;
font-weight:bold;
}

.city{
font-size:26px;
margin-top:5px;
}

/* cards */
.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:20px;
padding:20px;
}

.card{
background:white;
padding:20px;
border-radius:15px;
text-align:center;
box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

.time{
font-size:20px;
margin:6px 0;
}

canvas{
background:white;
border-radius:12px;
padding:10px;
}
</style>
</head>

<body>

<div class="header">
<div class="mantra">‡•ê ‡§∏‡•Ç‡§∞‡•ç‡§Ø‡§æ‡§Ø ‡§®‡§Æ‡§É</div>
<div class="city" id="cityName"></div>
<p id="timestamp"></p>
</div>

<div class="grid">
<div class="card" id="today"></div>
<div class="card" id="tomorrow"></div>
<div class="card" id="countdown"></div>
<div class="card" id="weather"></div>
<div class="card" id="aqi"></div>
</div>

<div style="padding:20px">
<h2 style="text-align:center">üìä Upcoming 30-Day Sun Trend</h2>
<canvas id="chart"></canvas>
</div>

<script>

/* ===== CHANGE CITY HERE ANYTIME ===== */
const CITY="Mumbai";
const lat=19.0760;
const lng=72.8777;

document.getElementById("cityName").innerText=CITY+" Sun Monitoring";

/* timestamp */
function updateTime(){
document.getElementById("timestamp").innerText=
"Updated: "+new Date().toLocaleString();
}
updateTime();
setInterval(updateTime,60000);

/* helpers */
function formatDate(d){
return d.toISOString().split("T")[0];
}

function getDuration(sr,ss){
return ((new Date(ss)-new Date(sr))/1000/3600).toFixed(2);
}

/* fetch sun data */
async function fetchSun(date){
const res=await fetch(
`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lng}&date=${date}&formatted=0`
);
return (await res.json()).results;
}

/* today + tomorrow */
async function loadBasic(){

let today=new Date();
let tomorrow=new Date();
tomorrow.setDate(today.getDate()+1);

let t=await fetchSun(formatDate(today));
let tm=await fetchSun(formatDate(tomorrow));

document.getElementById("today").innerHTML=`
<h3>Today</h3>
<div class="time">Sunrise: ${new Date(t.sunrise).toLocaleTimeString()}</div>
<div class="time">Sunset: ${new Date(t.sunset).toLocaleTimeString()}</div>
<div>Daylight: ${getDuration(t.sunrise,t.sunset)} hrs</div>
`;

document.getElementById("tomorrow").innerHTML=`
<h3>Tomorrow</h3>
<div class="time">Sunrise: ${new Date(tm.sunrise).toLocaleTimeString()}</div>
<div class="time">Sunset: ${new Date(tm.sunset).toLocaleTimeString()}</div>
<div>Daylight: ${getDuration(tm.sunrise,tm.sunset)} hrs</div>
`;

startCountdown(t.sunrise,t.sunset);
}

/* countdown */
function startCountdown(sr,ss){

function update(){
let now=new Date();
let sunrise=new Date(sr);
let sunset=new Date(ss);

let target=(now<sunrise)?sunrise:(now<sunset)?sunset:new Date(sunrise.getTime()+86400000);
let label=(now<sunrise)?"Next Sunrise":(now<sunset)?"Next Sunset":"Next Sunrise (Tomorrow)";

let diff=target-now;

let h=Math.floor(diff/1000/3600);
let m=Math.floor(diff/1000%3600/60);
let s=Math.floor(diff/1000%60);

document.getElementById("countdown").innerHTML=
`<h3>‚è≥ ${label}</h3><div class="time">${h}h ${m}m ${s}s</div>`;
}

update();
setInterval(update,1000);
}

/* 30 day trend (sunrise + daylight) */
async function loadTrend(){

let labels=[];
let sunriseData=[];
let daylightData=[];

for(let i=0;i<30;i++){

let d=new Date();
d.setDate(d.getDate()+i);

let r=await fetchSun(formatDate(d));

labels.push(d.toLocaleDateString());

let sr=new Date(r.sunrise);
sunriseData.push(sr.getHours()+sr.getMinutes()/60);

daylightData.push(getDuration(r.sunrise,r.sunset));
}

new Chart(document.getElementById("chart"),{
type:"line",
data:{
labels:labels,
datasets:[
{
label:"Sunrise Time (hour)",
data:sunriseData
},
{
label:"Daylight Hours",
data:daylightData
}
]
}
});
}

/* weather */
async function loadWeather(){
const res=await fetch(
"https://api.open-meteo.com/v1/forecast?latitude=19.0760&longitude=72.8777&current_weather=true"
);
const data=await res.json();

document.getElementById("weather").innerHTML=`
<h3>üå§ Weather</h3>
<div class="time">${data.current_weather.temperature}¬∞C</div>
<div>Wind: ${data.current_weather.windspeed} km/h</div>
`;
}

/* AQI */
async function loadAQI(){
const res=await fetch(
"https://air-quality-api.open-meteo.com/v1/air-quality?latitude=19.0760&longitude=72.8777&current=pm10,pm2_5"
);
const data=await res.json();

document.getElementById("aqi").innerHTML=`
<h3>üå´ AQI</h3>
<div>PM2.5: ${data.current.pm2_5}</div>
<div>PM10: ${data.current.pm10}</div>
`;
}

loadBasic();
loadTrend();
loadWeather();
loadAQI();

</script>

</body>
</html>
